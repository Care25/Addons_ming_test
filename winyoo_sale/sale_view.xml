<?xml version="1.0" encoding="UTF-8"?>
<openerp>
    <data>
   
    	<record model="ir.actions.act_window" id="sale.action_orders">
            <field name="domain">[('state', 'not in', ('draft', 'cancel'))]</field>
            <field name="context">{'search_default_my_sale_orders_filter': 1, 
            	'default_order_policy':'picking',
            	'default_state':'sent'}</field>
            <field name="limit">30</field>                     
        </record>
    	<record model="ir.actions.act_window" id="sale.action_quotations">
            <field name="domain">[('state', 'in', ('draft', 'cancel'))]</field>
            <field name="context">{'search_default_my_sale_orders_filter': 1,
            	'default_order_policy':'picking'}</field>
            <field name="limit">30</field>                     
        </record>
        <!-- เปลี่ยนชื่อ menu จาก SO เป็น DO -->
		<menuitem action="sale.action_orders" id="sale.menu_sale_order" 
			name="Delivery Order (DO)" parent="base.menu_sales" 
			sequence="6" groups="base.group_sale_salesman,base.group_sale_manager,base.group_sale_salesco"/>
    
    <!-- The main object: View name= sale.order.form 		External ID = sale.view_order_form		Object=sale.order-->
		 <record id="winyoo_sale_view_order_form" model="ir.ui.view">
		    <field name="name">winyoo_sale.view.order.form</field>
		    <field name="model">sale.order</field>
		    <field name="inherit_id" ref="sale.view_order_form"/>
		    <field name="arch" type="xml">

		    	<!-- มันมีสองปุ่มในหน้าใน ขึ้นคนละ state เลยต้องปิดมันสองครั้ง -->
		    	<button name="action_quotation_send" position="replace"></button>
		    	<button name="action_quotation_send" position="replace"></button>
		    	<button name="print_quotation" position="replace"></button>
		    	<button name="print_quotation" position="replace"></button>
		    	<button name="cancel" position="before">
                	<button name="button_mysent" string="Quotation to Order" type="object" states="draft" class="oe_highlight" groups="base.group_user"/>
				</button>
	    		<!-- hide "Confirm Sale" in draft state-->
	    		<button name="action_button_confirm" position="replace"></button> 
	    		
		    	<label string="Quotation " position="replace">
					<label string="Quotation " attrs="{'invisible': [('state','not in',('draft'))]}"/>
		    	</label>
		    	<label string="Sales Order " position="replace">
					<label string="Delivery Order " attrs="{'invisible': [('state','in',('draft'))]}"/>
		    	</label>

		    	<!--<field name="payment_term" position="after">-->
		    	<!--<field name="credit_term_id" />-->
				<!--<button name="button_mycancel" string="My Cancel" type="object" />-->
		    	<!--</field>-->
				<field name="partner_id" position="replace">
		    		<field name="partner_id" on_change="onchange_partner_id(partner_id, context)" domain="[('customer','=',True)]" 
		    			context="{'search_default_customer':1, 'show_address': 1}" options="{'always_reload': True,'no_quick_create':True,'no_create_edit':True}"/>
				</field>
				<field name="partner_invoice_id" position="replace">
                	<field name="partner_invoice_id" groups="sale.group_delivery_invoice_address" 
                		context="{'default_type':'invoice'}" options="{'no_quick_create':True,'no_create_edit':True}"/>
                </field>
                <field name="order_policy" position="replace"></field>                
                <field name="partner_shipping_id" position="after">
                	<field name="order_policy"/>
                </field>		    	



		    	
		    	<!--<field name="date_order" position="replace" >
		    		<field name="date_order" string="Delivery Date(ค.ศ.)"/>
		    	</field>-->

		    	<field name="date_order" position="attributes" >
		    		<attribute name="string">Order Date วันที่สั่งซื้อ(ค.ศ.)</attribute>
		    	</field>
		    	<field name="requested_date" position="replace"></field>
		    	<field name="payment_term" position="replace"></field>
		    	<field name="date_order" position="after" >
		    		<field name="requested_date" string="Requested Date วันที่ต้องการส่ง" 
		    			attrs="{'required':[('state','not in',('draft','cancel'))],'readonly':[('state','in',('draft'))] }" 
		    			on_change="onchange_requested_date(requested_date, commitment_date)"/>
		    		<field name="payment_term" options="{'no_quick_create':True,'no_create_edit':True}"/>
		    	</field>
		    	
		    	
		    	<field name="client_order_ref" position="replace" >
		    		<field name="client_order_ref" string="อ้างอิงPOลูกค้า" attrs="{'invisible':[('state','in',('draft'))]}"/>
		    	</field>

		    	<field name="pricelist_id" position="after">
		    			<field name="sale_authority" placeholder="ชื่อคนเซ็นต์อนุมัติ" attrs="{'invisible':[('state','not in',('draft'))]}"/>	
		    			<h2><label string="For Quotation" attrs="{'invisible':[('state','not in',('draft'))]}"/></h2><hr/>
		    			<field name="min_q_delivery" placeholder="เช่น ขั้นต่ำ 1 ตัน ต่อการส่ง" attrs="{'invisible':[('state','not in',('draft'))]}"/>
		    			<field name="leadtime_delivery" placeholder="เช่น 30 วันหลังจากได้รับใบสั่งซื้อ" attrs="{'invisible':[('state','not in',('draft'))]}"/>
		    			<field name="place_delivery" string="Delivery Place" placeholder="เช่น ส่งที่ มหาชัย" attrs="{'invisible':[('state','not in',('draft'))]}"/>		    			    		
		    			<field name="price_valid" placeholder="เช่น 30วัน หรือ 30/2/2558" attrs="{'invisible':[('state','not in',('draft'))]}"/>

		    	</field>
		    	
		    	<field name="origin" position="attributes" >
		    		<attribute name="string">Ref.Doc (จาก SQ No.)</attribute>
					<attribute name="attrs">{'invisible':[('state','in',('draft'))]}</attribute>
		    	</field>
		    	    <field name="campaign_id" position="attributes">
		    	    	<attribute name="invisible">True</attribute>
		    	    </field>
                    <field name="medium_id" position="attributes">
                    	<attribute name="invisible">True</attribute>
		    	    </field>
                    <field name="source_id" position="attributes">
                    	<attribute name="invisible">True</attribute>
		    	    </field>
		    		<field name="user_id" position="replace">
		    			<field name="user_id" 
		    				context="{'default_groups_ref': ['base.group_sale_salesman']}"
		    				required="True"/>
		    			<!--<field name="user_id" context="{'default_groups_ref': ['base.group_user', 'base.group_partner_manager', 'account.group_account_invoice', 'base.group_sale_salesman_all_leads']}"/> -->
		    			
		    		</field>
		    	
		    	
		    	
<!--  FIeld in Sale order line (in view "sale_order_view") -->
				<field name="tax_id">
					<field name="tax_id" widget="many2many_tags" domain="[('parent_id','=',False),('type_tax_use','&lt;&gt;','purchase')]" 
						options="{'no_quick_create':True,'no_create_edit':True}"/>
				</field>
				
<!-- Delete editable = "bottom" -->
				<tree string="Sales Order Lines" position="replace">
					 <tree string="Sales Order Lines">
                                    <field name="sequence" widget="handle"/>
                                    <field name="state" invisible="1"/>
                                    <field name="th_weight" invisible="1"/>
                                    <field name="product_id"
                                        context="{'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':parent.pricelist_id, 'uom':product_uom}"
                                        groups="base.group_user"
                                        on_change="product_id_change(parent.pricelist_id, product_id, product_uom_qty, False, product_uos_qty, False, name, parent.partner_id, False, True, parent.date_order, False, parent.fiscal_position, False, context)"/>
                                    <field name="name"/>
                                    <field name="product_uom_qty"
                                        context="{'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':parent.pricelist_id, 'uom':product_uom}"
                                        on_change="product_id_change(parent.pricelist_id, product_id, product_uom_qty, product_uom, product_uos_qty, product_uos, name, parent.partner_id, False, False, parent.date_order, False, parent.fiscal_position, True, context)"/>
                                    <field name="product_uom"
                                        on_change="product_uom_change(parent.pricelist_id, product_id, product_uom_qty, product_uom, product_uos_qty, product_uos, name, parent.partner_id, False, False, parent.date_order, context)"
                                        groups="product.group_uom" options='{"no_open": True}'/>
                                    <field name="product_uos_qty" groups="product.group_uos" invisible="1"/>
                                    <field name="product_uos" string="UoS" groups="product.group_uos" invisible="1"/>
                                    <field name="price_unit"/>
                                    <field name="tax_id" widget="many2many_tags" domain="[('parent_id','=',False),('type_tax_use','&lt;&gt;','purchase')]"/>
                                    <field name="discount" groups="sale.group_discount_per_so_line"/>
                                    <field name="price_subtotal"/>
                	</tree>               
				</tree>
				
				
				<!-- delay อยู่ใน stock_view.xml-->
 				
				<field name="delay" position="attributes" >
					 <attribute name="readonly">True</attribute>
		    	</field>
		    	<field name="th_weight" position="attributes" >
					 <attribute name="invisible">True</attribute>
		    	</field>
		    	<field name="address_allotment_id" position="attributes" >
					 <attribute name="invisible">True</attribute>
		    	</field>				
 				
		    </field>
		</record>
 
 
 
    </data>
</openerp>

